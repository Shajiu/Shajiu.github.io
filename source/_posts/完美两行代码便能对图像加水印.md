---
title: 完美! 两行代码便能对图像加水印、文件对比以及利好抓包
top: false
cover: false
toc: true
mathjax: true
date: 2021-10-17 10:32:50
password:
summary:
tags: 专业
categories: 语言(Python)
---
## 完美! 两行代码便能对图像加水印、文件对比以及利好抓包
####   一 、 引言：
今天都知道python是一个强大的编程语言，里面集成了很多有趣的第三方库。今天向大叫介绍一个比较好玩的工具filestools，它通过两行代码便可对图像增加水印，可以对比两个文件的差异，还可以利好抓包的curl转为python的requests请求代码。
####  二 、安装
filestools库具有如下功能：
1. 仿 Linux 树形目录显示 tree 命令；
2. 文件差异比较 diff 命令；
3. 图片加水印 marker 命令；
4. curl 请求命令转 python 请求代码。
5. 安装命令如下：```pip install filestools -U```

#### 三 、图像加水印
导入水印模块
```Python
 from watermarker.marker import add_mark
  ```
*add_mark 方法有8个参数：*
- file：图片文件或图片文件夹路径；
- mark：要添加的水印内容；
- out：添加水印后的结果保存位置，默认生成到 output 文件夹；
- color：水印的颜色设置；
- space：水印直接的间隔, 默认 75 个空格；
- angle：水印旋转角度，默认 30 度；
- size：水印字体的大小，默认 50；
- opacity：水印的透明度，默认 0.15

#### 四、 具体实例
身份证经常需要被上传并用在实名认证上面，我们可以加上水印防止被盗用
![图1 未水印前的图像](http://ndp971.bvimg.com/12724/18cd5d32371d305b.jpg)
经过水印处理
```python
from watermarker.marker import add_mark
add_mark(r"D:\personal\gitpython\maoyan\0.png", "“源码上门取算法码上到", angle=15, size=20, space=40, color='#c5094d')
 ```
 ![图2 水印后的图像](http://ndp971.bvimg.com/12724/d67d1aa0ba5da0e6.jpg)

#### 五、文件对比
导入水印模块
```Python
from filediff.diff import file_diff_compare
```
*file_diff_compare 方法有 7 个参数：*
- file1：被比较的文件 1;
- file2：被比较的文件 2;
- out：差异结果保存的文件名，默认值 diff_result.html;
- max_width：每行超过多少字符就自动换行，默认值 70;
- numlines：在差异行基础上前后显示多少行，默认是 0;
- show_all：只要设置这个参数就表示显示全部原始数据，此时 numlines 参数无效；默认不显示全部;
- no-browser：设置这个参数，在生成结果后不会自动打开游览器.
举个例子，有以下两个文件：
![图3 对比文本文件图像](http://ndp971.bvimg.com/12724/0b37feddddba5b59.png)

经过文件对比:
```Python
from filediff.diff import file_diff_compare
file_diff_compare(r"D:\一线城市.log", r"D:\一线城市2.log", diff_out="diff_result.html", max_width=70, numlines=0, no_browser=True)
```
绿色表示新增，黄色表示修改，红色表示被删除。
![图4 第一种结果图像](http://ndp971.bvimg.com/12724/2c4aa792057e8cd6.png)
当使用了 show_all 参数之后，将显示所有：
```Python
from filediff.diff import file_diff_compare
file_diff_compare("D:\一线城市.log", "D:\一线城市2.log", diff_out="diff_result.html", show_all=True, no_browser=True)
```
![图5 第二种结果图像](http://ndp971.bvimg.com/12724/de52c6df3e95e3ba.png)

#### 六、curl 请求命令转 python 请求代码
curl 转 python 的用法完全利好爬虫，可以少写一些抓包代码。这个 api 会生成 headers、requests.get() 等内容。
先在谷歌游览器中复制网络抓到的网络请求为cURL(bash)，如下图：

![图6 网页获取截图图像](http://ndp971.bvimg.com/12724/4395660ab135635b.jpg)
复制出来的内容类似：
``` curl
curl 'https://dss0.bdstatic.com/5aV1bjqh_Q23odCf/static/mancard/img/side/qrcode@2x-daf987ad02.png' \
  -H 'sec-ch-ua: "Chromium";v="94", "Google Chrome";v="94", ";Not A Brand";v="99"' \
  -H 'Referer: https://www.baidu.com/' \
  -H 'sec-ch-ua-mobile: ?0' \
  -H 'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36' \
  -H 'sec-ch-ua-platform: "Windows"' \
  --compressed
  ```
使用 curl 转 python
```Python
from curl2py.curlParseTool import curlCmdGenPyScript

curl_cmd = """curl 'https://dss0.bdstatic.com/5aV1bjqh_Q23odCf/static/mancard/img/side/qrcode@2x-daf987ad02.png' \
  -H 'sec-ch-ua: "Chromium";v="94", "Google Chrome";v="94", ";Not A Brand";v="99"' \
  -H 'Referer: https://www.baidu.com/' \
  -H 'sec-ch-ua-mobile: ?0' \
  -H 'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.71 Safari/537.36' \
  -H 'sec-ch-ua-platform: "Windows"' \
  --compressed"""
output = curlCmdGenPyScript(curl_cmd)
print(output)
  ```
 ![图7 curl转python后的结果](http://ndp971.bvimg.com/12724/2b37a120e05ac6ee.png)

 #### 七、总结
 python 中有趣并且好用的第三方库还有很多，小编会在后面的"源码上门取算法码上到"公众号文章中为大家继续介绍。