---
title: 开源软件程序设计接口
top: false
cover: false
toc: true
mathjax: true
date: 2021-12-22 09:21:48
password:
summary:
tags: 个人提升
categories: 周总结
---
### 软件程序接口设计

#### 重要性

###### 为什么要重视API设计？

- 降低用户学习成本
- 例如：用户主要使用Python
- Tensorflow把C++ API包装成Python
- 开源软件不是单独的存在
- API决定技术栈的稳定性
- 为上层建筑打下基础
- API设计VS底层技术
- API设计又超高的性价比

![底层技术与API的成本和收益](https://s2.loli.net/2021/12/22/wFuKEHpdiYh38rx.jpg)

#### 新挑战

- 用户需求未知

![用户需求未知](https://s2.loli.net/2021/12/22/i7I15H8w2LZklmG.jpg)

- 用户群体割裂
- 把需求缝合进同一套API

![把需求缝合进同一套API](https://s3.bmp.ovh/imgs/2021/12/fe635741eb6c13a1.jpg)

#### 基本原则

###### 原则一、代码未动，设计先行

- 有设计，才有可能有好的设计
- 有API设计倒推代码结构

![有API设计倒推代码结构](https://s3.bmp.ovh/imgs/2021/12/fcf3e83496a5f9bf.jpg)

- 谨慎修改API，重走设计流程
- 谨慎增加API,会增加历史包袱

![谨慎增加API,会增加历史包袱](https://s3.bmp.ovh/imgs/2021/12/3e2ed7cfae96ac22.jpg)

###### API设计文档里有什么？

- 把设计文档当教程写
- 单个函数定义VS完整代码段

![单个函数定义VS完整代码段](https://s3.bmp.ovh/imgs/2021/12/c3e36dd690570b36.jpg)

- 写完整的代码段

```Python
output_tensor=x_text
for layer in model.layers:
     output_tesor=layer(output_tensor)
     print(output_tensor)

class Layer(tf.Module):
     def __call__(self,tensor):
          pass
 ```

###### 原则二、所想即所得

- 好的API设计

![好的API设计](https://s3.bmp.ovh/imgs/2021/12/21c079e686cc3ad8.jpg)

- 正例

```Keras Model
model=keras.Sequential([
   layers.Conv2D(filters=32,kernel_size=3,activation='relu'),
   layers.Conv2D(filters=32,kernel_size=3,activation='relu'),
   layers.Flatten(),
   layers.Dense(10,activation='softmax'),
   ])

model.compile(
    optimizer='adam',
    loss='categorical_crossentropy')
model.fit(x_train,y_train,epochs=3)
model.predict(x_test)
 ```

- 最差API设计

![最差API设计](https://s3.bmp.ovh/imgs/2021/12/0a88c67bfb704d87.jpg)

- 反例

```TF1 Tensor
# 给用户灌输编译器中的概念
x=tf.placeholder("float",None)
y=x*2
# y是tensor,能相乘却没有值
with tf.Session() as session:
     result=session.run(y,feed_dict={x:[1,2,3]})
     print(result)
 ```

- 如何兼顾两者的需求？

![如何兼顾两者的需求？](https://s3.bmp.ovh/imgs/2021/12/ccd4299d550de3de.jpg)

- 让用户只学习必要的知识

```Python
model.compile(
    optimizer='adam',
    loss='categorical_crossentropy'
    model.fit(x_train,y_train,epochs=3)
 ```

###### 科学家VS工程师

- 只学习必要的内容

- 降低学习门槛

###### 原则三、让用户在交互中学习

- 代码不是一种静态的存在
- 引入时间维度

![引入时间维度](https://s3.bmp.ovh/imgs/2021/12/985d5cda5f5c808c.jpg)

- 用户难以一次行写对

- 在试错中前进

![在试错中前进](https://s3.bmp.ovh/imgs/2021/12/81c43d03f6e79e8c.jpg)

- 尽早捕捉异常

- 发出有意义的信息

![发出有意义的信息](https://s2.loli.net/2021/12/22/IXUTmvY6wqSuPZO.jpg)

- 最佳错误信息：指导用户如何修正

![最佳错误信息：指导用户如何修正](https://s2.loli.net/2021/12/22/yZ23Bm9bpnEfGTN.jpg)

###### 一条朴素的API评价标准

<font face="逐浪立楷" color=green size=3>用户能轻易掌握API的使用逻辑，并在根据这种逻辑构建自己的应用，而很少查阅文档。</font>

#### 总结

|重要性|新挑战|基本原则|
|:---:|:---:|:---:|
|① 降低学习成本；②生态稳定性；③高性价比|① 无法提前接触用户；② 用户群体割裂|<font color= #871F78>原则一代码未动、设计先行：谨慎修改增加API、写完整代码段; </font><font color=#008000>原则二、所想即所得:契合用户心理表征、尽量不灌输新概念、不迷惑用户、只学需要的；</font><font color=Blue>原则三、让用户在交互中学习:用户需要试错、尽早捕捉异常 、抛出有意义的异常信息、指导用户修正</font>
|
